---
title: "Lab: Creating Good Graphics"
author: "Jesus Rodriguez"
format: html
number-sections: true
number-depth: 2
messages: false
errors: false
warnings: false
editor: 
  markdown: 
    wrap: sentence
---

::: callout
You can see the purpose of this assignment as well as the skills and knowledge you should be using and acquiring, in the [Transparency in Learning and Teaching (TILT)](tilt.qmd) document in this repository.
The TILT document also contains a checklist for self-reflection that will provide some guidance on how the assignment will be graded.
:::

# Graphical Critiques

The following code was [generated by Claude AI vers. Sonnet 4.5](4-types-graphics-claude.md) (with some modifications).

```{r}
#| label: fig-comparing-graphics-figures
#| fig-cap: "Four different representations of COVID vaccination rates."
#| fig-subcap: ["Pie chart highlighting the percentage of total vaccinations by age groups over the course of 12 weeks. Older age groups make up a higher percentage of total vaccinations, and as age groups decrease, so does the percentage of total vaccinations.", "Line graph showcasing the vaccination rates over 12 weeks for different age groups. As time progressed, the trend of older age groups having a higher vaccination rate than younger age groups remained persistent, despite the vaccination rate increasing for all age groups.", "Stacked area chart displaying the the cumulative vaccination rate over 12 weeks for the total population grouped by age. At the beginning of the 1st week, age groups had significantly different cumulative vaccination rates, showing that more vaccinations were given to older age groups. However, at the 12th week, more vaccinations were adminstered to more age groups increasing their cumulative vaccination rate, but the trend of older ages making up a higher percentage remains.", "Grouped bar chart showing vaccination rates by age group over 12 weeks. Older age groups having a higher vaccination rate than younger age groups was a trend that remained constant. All age groups peaked at the 12th week."]
#| fig-alt: ["Pie chart highlighting the total vaccination rate of the population after 12 weeks by 4 different age groups.", "Alt 2", "Alt 3", "Alt 4"]
#| layout-ncol: 2
#| code-fold: true


# Load required libraries
suppressPackageStartupMessages({
  library(ggplot2)
  theme_set(theme_bw())
  library(dplyr)
  library(tidyr)
})

# Create sample dataset
set.seed(123)
weeks <- 1:12
age_groups <- c("18-29", "30-49", "50-64", "65+")

# Generate vaccination rate data with realistic patterns
vaccination_data <- data.frame(
  week = rep(weeks, each = 4),
  age_group = rep(age_groups, times = 12),
  vaccination_rate = c(
    # Week-by-week data for each age group
    12, 18, 25, 35,  # Week 1
    15, 22, 30, 41,  # Week 2
    18, 26, 35, 47,  # Week 3
    22, 31, 41, 54,  # Week 4
    26, 36, 47, 60,  # Week 5
    30, 41, 53, 66,  # Week 6
    34, 46, 58, 71,  # Week 7
    38, 50, 63, 75,  # Week 8
    42, 54, 67, 79,  # Week 9
    45, 58, 71, 82,  # Week 10
    48, 61, 74, 85,  # Week 11
    51, 64, 77, 87   # Week 12
  )
)

# Set factor levels for consistent ordering
vaccination_data$age_group <- 
  factor(vaccination_data$age_group, 
         levels = c("18-29", "30-49", "50-64", "65+"))

# Define color palette
age_colors <- c("18-29" = "#FF6B6B", 
                "30-49" = "#4ECDC4", 
                "50-64" = "#FFD93D", 
                "65+" = "#95E1D3")

# CHART A: 3D Pie Chart (showing total vaccinations by age group)

# Calculate total vaccinations per age group (sum across weeks)
total_by_age <- vaccination_data %>%
  group_by(age_group) %>%
  summarise(total = sum(vaccination_rate))

# Create pie chart with 3D-like appearance using custom positioning
chart_a <- ggplot(total_by_age, aes(x = "", y = total, fill = age_group)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values = age_colors) +
  labs(title = "3D Pie Chart - Total Vaccinations by Age Group",
       tag = "Chart A",
       subtitle = "(Summed across all 12 weeks)",
       fill = "Age Group") +
  theme_void() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 10, face = "italic"),
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 10)
  ) +
  # Add percentage labels
  geom_text(aes(label = paste0(round(total/sum(total)*100, 1), "%")),
            position = position_stack(vjust = 0.5),
            size = 4, fontface = "bold")

# CHART B: Line Graph - Vaccination Rates Over Time

chart_b <- ggplot(vaccination_data, aes(x = week, y = vaccination_rate, 
                                        color = age_group, group = age_group)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2.5) +
  scale_color_manual(values = age_colors) +
  scale_x_continuous(breaks = 1:12) +
  labs(title = "Line Graph - Vaccination Rates Over Time",
       tag = "Chart B",
       x = "Week",
       y = "Vaccination Rate (%)",
       color = "Age Group")

# CHART C: Stacked Area Chart - Vaccination Rates Over Time

chart_c <- ggplot(vaccination_data, aes(x = week, y = vaccination_rate, 
                                        fill = age_group)) +
  geom_area(alpha = 0.8, position = "stack") +
  scale_fill_manual(values = age_colors) +
  scale_x_continuous(breaks = 1:12) +
  labs(title = "Stacked Area Chart - Vaccination Rates Over Time",
       tag = "Chart C",
       x = "Week",
       y = "Cumulative Vaccination Rate (%)",
       fill = "Age Group")


# CHART D: Grouped Bar Chart - Vaccination Rates by Week and Age Group

chart_d <- ggplot(vaccination_data, aes(x = factor(week), y = vaccination_rate, 
                                        fill = age_group)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.8) +
  scale_fill_manual(values = age_colors) +
  labs(title = "Grouped Bar Chart - Vaccination Rates by Week and Age Group",
       tag = "Chart D",
       x = "Week",
       y = "Vaccination Rate (%)",
       fill = "Age Group")

chart_a
chart_b
chart_c
chart_d
```

1.  Edit the chunk options above to produce helpful and descriptive captions and alt-text for each chart. Every chart you include in a document should be referenced in the text (preferably using a cross-reference) and should have a helpful caption and include at least short alt-text descriptions using the `fig-alt` quarto option.\
    Resources:

-   [Mastering Alt Text for Images and Charts](https://a11ykat.medium.com/see-the-unseen-mastering-alt-text-for-images-and-charts-6d3dbe36553b)
-   [Image Accessibility Generator](https://asuo-ai-labs.streamlit.app/Image_Accessibility) - This is a great tool but I often have to customize the output. I usually use the long text for image descriptions, which is not *best* practice but tends to work better than many of the other options available within the quarto ecosystem.

2.  Using the grammar of graphics, identify the geom, mappings, stat, positions, coordinate systems, and transformations for each graphic. Fill in the table below accordingly, leaving any cells which do not apply to the chart blank. If a mapping is a function of a statistic, fill in the statistic function from ggplot2 and indicate the mapping using the appropriate [`after_stat` variable](https://ggplot2.tidyverse.org/reference/aes_eval.html.).

| Chart | Geom | X mapping | Y mapping | Color mapping | Fill mapping | Stat | Position | Coord System | Transform |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| A | bar | total vaccination percentage |  | "white" | age group | identity |  | polar |  |
| B |  line, point |  time | vaccination rate | age group |  |  |  | cartesian |  |
| C | area | time | cumulative vaccination rate |  | age group | |  | cartesian |  |
| D | bar | time | vaccination rate |  | age group | identity | dodge | cartesian |  |

: Grammar of graphics mappings for the four charts

3.  Examine each chart and determine whether it effectively communicates changes in vaccine rates over time across different age groups.
    If the chart is inappropriate for that comparison, explain why; if it is appropriate but not optimal, explain what you would change.

    A.  Chart A does an ok job at communicating the percentage of each age group that *has* been vaccinated. That is where its accomplishments end. It doesn't really communicated changes in vaccine rates over time across different age groups. The only "time variable" in the graph is the label that that the totals were summed for the 12 weeks, this isn't appropriate to capture any changes during those 12 weeks. It may be hard for some to understand that the chart isn't saying ~1/3 of people aged over 65 are vaccinated, but it is instead saying that out of all total people vaccinated, 1/3 of those people are aged over 65. 

    B.  Chart B clearly shows the vaccination rate of each age group over 12 weeks. It is simple to notice that at the start of the first week just how low the vaccination rate was for each age group and how the vaccine rate grew over time. One small thing (that doesn't really bother me at all) is that the points on the graph only serve to point out the week, perhaps they could be better used only when an important milestone or event happened to signify that date/week from the rest. 

    C.  Chart C may be very confusing to the average person. It can be easy for someone to misinterpret the graph and mistake age group 18-29 to receiving the most vaccines and vice versa for age group 65+. You are supposed to look at the area of each age group, rather than the height, and for that I think it doesn't do a great job showcasing the vaccination rate over time for each age group. 

    D.  Chart D does a good job at differentiating each age group and their vaccination rate over time. The only problem is that time is a continuous variable, so if the x-axis was created using dates and not "Week 1, Week 2, Week 3...", there could be some information lost or simplified during the time between those weeks.

4.  Examine each chart and critique the use of Gestalt principles of grouping.
    What principles apply?
    Are they used effectively?

    A.  Chart A using "closure" to group the pie chart as one and 

    B.  Chart B uses "continuation" and "similarity" to have each age group stand out from the rest.

    C.  

    D.  

5.  Consider the "messages" you might want viewers to take away from this data and the visuals you generate.

    a.  Brainstorm 2-3 reasonable messages

    > Here is how the proportion of each group got vaccinated over 12 weeks
    
    > The more older the classification of an age group, the higher proportion of that group being vaccinated
    
    > Currently on the 12th week, at least half of everyone is vaccinated

    b.  What do you think the most important message is from this data set?

    > At least half of everyone in each age group listed is vaccinated, some groups such as those aged 65 and over have a higher percentage of vaccinated people. 

    c.  Which comparisons do you want to make easier for participants to perform?

    > How different (or similar) each age group's vaccination rate is from each other
    
    > How different (or similar) each age group's vaccination rate changed each week / over time.

    d.  What obstacles do you expect to encounter designing a chart to facilitate these comparisons?

    > Minimizing misinterpretation
    
    > Providing the right amount of information without cluttering the chart

6.  Considering your answers to the questions above, create your own version of the chart that minimizes cognitive load and maximizes interpretability.
    Explain the changes that you made and why they improve the chart compared to the ones generated by Claude.

# Choose Your Own Adventure

Claude used fake data, but we have access to the [real deal](https://data.cdc.gov/Vaccinations/Weekly-Cumulative-Estimated-Number-of-COVID-19-Vac/ewpg-rz7g/about_data), and I've downloaded a [csv](Weekly_Cumulative_Estimated_Number_of_COVID-19_Vaccinations_Administered_in_Pharmacies_and_Physician_Medical_Offices,_Adults_18_years_and_older,_by_Season_and_Age_Group,_United_States_20251021.csv) to simplify the process.

Of course, the CDC only tracks number of vaccines, not the overall vaccination rate.

## Task 1

1.  Augment this data with census estimates of the population size for each age group.
    In either case, you may need to do a bit of inference/subtraction to get the counts for the age brackets used by the CDC.
    Provide reproducible code that generates a population table for 2023 and 2024 with the appropriate counts for each age bracket provided by the CDC.

    Options:

    -   Use the Census QuickFacts page https://www.census.gov/quickfacts/
    -   Use the [nc-est2024-agesex.xlsx](nc-est2024-agesex.xlsx) population by age and sex file I downloaded from the [US Census](https://www.census.gov/data/tables/time-series/demo/popest/2020s-national-detail.html).
    
```{r setup, warning = F, message = F, output = F}
library(tidyverse)
library(skimr)
library(readxl)
library(lubridate)
library(purrr)
```
 
```{r, message = F}
weekly_cumulative_vaccines_administered_data <- 
  read_csv("Weekly_Cumulative_Estimated_20251021.csv")
```
 
```{r, message = F}
national_population_data <- 
  read_xlsx('nc-est2024-agesex.xlsx', skip = 2,col_names = F)
```
    
### National Population Data Cleaning

```{r}
new_names <- 
  c("2020", '2020', '2020', '2020', 
    '2020', '2020', '2021', '2021', 
    '2021', '2022', '2022', '2022', 
    '2023', '2023', '2023', '2024', 
    '2024', '2024') # this was useful later

cleaned <- 
  national_population_data %>% 
  slice(3:(n()-8)) %>% 
  filter(!if_all(everything(), is.na))

new_new_names <- 
  c("age", cleaned[1,2:19])

names(cleaned) <- 
  new_new_names

cleaned <- 
  cleaned[2:32,1:19] %>% 
  pivot_longer(
    cols = -age,
    names_to = "year",
    values_to = "population_size"
  ) %>% 
  mutate(
    year = rep(new_names, 31),
    month = 
      ifelse(
        year == "2020",
        c("April", "April","April", "July","July","July"),
        year
      ), 
    sex = rep(c("Both", "Male", "Female"), 186)
  ) %>% 
  select(age, year, month , sex, population_size)

national_population_data <- cleaned
rm(cleaned)
rm(new_new_names)
rm(new_names)
```

### Appropriate Age Brackets for 2023 and 2024

> Provide reproducible code that generates a population table for 2023 and 2024 with the appropriate counts for each age bracket provided by the CDC.

```{r}
weekly_cumulative_vaccines_administered_data %>% 
  group_by(Age_Group) %>% 
  count()
```


```{r}
national_population_data %>%
  filter(year == "2023" | year == "2024") %>%
  group_by(age) %>%
  count()
```

```{r}
census_data <-
  national_population_data %>%
  mutate(
    age =
      # the period at the beginning was bothering me
      str_remove(age, "\\."),
    age =
      str_trim(age)
  ) %>%
  filter(
    age == "18 years and over" | # 18+
    age == "18 to 24 years" | age == "25 to 29 years" |  ### 18 - 
      age == "30 to 34 years" | age == "35 to 39 years" | ### - 
      age == "40 to 44 years" | age == "45 to 49 years" | ### - 49
      age == "50 to 54 years" | age == "55 to 59 years" | age == "60 to 64 years" | # 18-64 and 50-64
      age == "65 years and over" | # 65+
      age == "75 to 79 years" | age == "80 to 84 years" | age == "85 years and over" # 75+
  ) %>%
  mutate(
    year = as.numeric(year), 
    sex = as.factor(sex),
    population_size = as.numeric(population_size),
    age =
      # I should have done this step 1st :'(
      # don't want to do the work from last step again so I'll leave it like this
      str_replace(age, " to ", "-"),
    age =
      str_remove_all(age, "[a-z]"),
    age =
      str_trim(age),
    age =
      case_when(
        age == "18" ~ "18+",
        age == "65" ~ "65+",
        age == "85" ~ "85+",
        T ~ age
      )
    )%>%
  arrange(age) %>%
  select(
    age, year, month, sex, population_size
  )
# THIS DID NOT WORK NEED TO DUPLICATE ROWS SOMEHOW TO WORK
# %>% 
#   mutate(
#     age_group = 
#       case_when(
#         (age == "18-24" | age == "25-29" | 
#            age == "30-34" | age == "35-39" |
#            age == "40-44" | age == "45-49") ~ "18-49",
#         (age == "18-24" | age == "25-29" | 
#            age == "30-34" | age == "35-39" |
#            age == "40-44" | age == "45-49" | 
#            age == "50-54" | age == "55-59" | 
#            age == "60-64") ~ "18-64",
#         (age == "50-54" | age == "55-59" | 
#            age == "60-64") ~ "50-64",
#         (age == "60-64" | age == "65-69" | 
#            age == "70-74") ~ "60-74",
#         (age == "75-79" | age == "80-84" | 
#            age == "85+") ~ "75+",
#         T ~ age
#       )
#   ) %>% 
#   group_by(year, month, sex, age_group) %>% 
#   summarise(
#     total_population = sum(population_size)
#   ) %>% 
#   ungroup() %>% 
#   select(age_group, year, month , sex, total_population)
```

```{r}
age_group_map <- 
  function(age) {
    groups <- c()
    if (age %in% c("18-24","25-29","30-34","35-39","40-44","45-49","50-54",
                   "55-59","60-64","65-69","70-74","75-79","80-84","85+")) groups <- c(groups, "18+")
    if (age %in% c("18-24","25-29","30-34","35-39","40-44","45-49")) groups <- c(groups, "18-49")
    if (age %in% c("18-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64")) groups <- c(groups, "18-64")
    if (age %in% c("50-54","55-59","60-64")) groups <- c(groups, "50-64")
    if (age %in% c("60-64","65-69","70-74")) groups <- c(groups, "60-74")
    if (age %in% c("65-69","70-74","75-79","80-84","85+")) groups <- c(groups, "65+")
    if (age %in% c("75-79","80-84","85+")) groups <- c(groups, "75+")
    groups
  }

census_expanded <- 
  census_data %>%
  mutate(
    age_group = 
      map(age, age_group_map)
    ) %>%
  unnest(age_group) %>% 
  group_by(year, month, sex, age_group) %>% 
  summarise(
    total_population = sum(population_size)
  ) %>% 
  ungroup() %>% 
  mutate(
    age_group = 
      as.factor(age_group)
  )
```
### Population Table 2023 and 2024

```{r}
census_expanded %>% 
  filter(year == "2023") %>% 
  group_by(age_group, total_population) %>% head(7)
```
```{r}
census_expanded %>% 
  filter(year == "2024") %>% 
  group_by(age_group, total_population) %>% head(7)
```

### Joining for vaccination rate

```{r}
## Since the CDC only has data for years 2023, 2024, and 2025,
## I am filtering my census data for years 2023 and 2024 
## (There is no census data for 2025)

weekly_cumulative_vaccines_administered_data <- 
  weekly_cumulative_vaccines_administered_data %>% 
  rename(age_group = Age_Group) %>% 
  mutate(
    age_group = as.factor(age_group)
  )
vaccination_rate_data <- 
census_expanded %>% 
  filter(year == "2024" | year == "2023") %>% 
  select(year, sex, age_group, total_population) %>% 
  inner_join(
    weekly_cumulative_vaccines_administered_data, 
    by = "age_group", 
    suffix = c("_census", "_cdc"), 
    relationship = "many-to-many"
  ) %>% 
  filter(
    year == MMWR_Year, Setting == "Combined"
  ) %>% 
  mutate(
    vaccination_rate = 
      Doses / total_population * 100,
    cumulative_vaccination_rate = 
      Cumulative_Doses / total_population * 100,
    Week_ID = 
      ymd_hms(Week_ID)
  )
```


### disgusting messy code fold

<!-- This is just to fold my code in R, some of it I need to reuse -->

<!-- We have age groups 50-64, and 65+, but need 18-29 and 30-49. To get these, I will use age group 18-49 and split it. 18-29 covers 12 years (counting 18 as 1) and 30-49 covers 20 (counting 30 as 1), so it can be split proportionally 18-29 = 12/32 = 0.375 of all doses from 18-49. Likewise, 30-49 = 0.625 of all doses from 18-49.  -->

<!-- ```{r} -->
<!-- weekly_cumulative_vaccines_administered_data <-  -->
<!--   weekly_cumulative_vaccines_administered_data %>%  -->
<!--   filter(Age_Group == "18-49" | Age_Group == "50-64" | Age_Group == "65+") %>%  -->
<!--   mutate( -->
<!--     Age_Group = -->
<!--       ifelse( -->
<!--         Age_Group == "18-49", -->
<!--         "18-29", -->
<!--         Age_Group -->
<!--       ) -->
<!--   ) %>%  -->
<!--   bind_rows(.,  -->
<!--             weekly_cumulative_vaccines_administered_data %>%  -->
<!--               filter(Age_Group == "18-49") %>%  -->
<!--               mutate(Age_Group = "30-49")) -->
<!-- ``` -->

<!-- Now I need to multiple the doses by 0.375 and 0.625 respectively. -->

<!-- ```{r} -->
<!-- weekly_cumulative_vaccines_administered_data <-  -->
<!-- weekly_cumulative_vaccines_administered_data %>%  -->
<!--   mutate( -->
<!--     Doses =  -->
<!--       case_when( -->
<!--         Age_Group == "18-29" ~ Doses * 0.375,  -->
<!--         Age_Group == "30-49" ~ Doses * 0.625, -->
<!--         T ~ Doses -->
<!--       ), -->
<!--     Cumulative_Doses =  -->
<!--       case_when( -->
<!--         Age_Group == "18-29" ~ Cumulative_Doses * 0.375,  -->
<!--         Age_Group == "30-49" ~ Cumulative_Doses * 0.625, -->
<!--         T ~ Cumulative_Doses -->
<!--       ) -->
<!--   ) %>%  -->
<!--   arrange(Age_Group) -->
<!-- ``` -->

<!-- Now I need appropriate age brackets in the national population data. -->

<!-- ```{r} -->
<!-- national_population_data %>%  -->
<!--   filter(year == "2023" | year == "2024") %>%  -->
<!--   group_by(age) %>%  -->
<!--   count() -->
<!-- ``` -->

<!-- ```{r} -->
<!-- national_population_data <-  -->
<!--   national_population_data %>%  -->
<!--   filter(year == "2023" | year == "2024") %>%  -->
<!--   mutate( -->
<!--     age =  -->
<!--       # the period at the beginning was bothering me -->
<!--       str_remove(age, "\\."), -->
<!--     age =  -->
<!--       str_trim(age) -->
<!--   ) %>%  -->
<!--   filter( -->
<!--     age == "18 to 24 years" | age == "25 to 29 years" |  # 18-29 -->
<!--       age == "30 to 34 years" | age == "35 to 39 years" | ### -->
<!--       age == "40 to 44 years" | age == "45 to 49 years" | # 30-49 -->
<!--       age == "50 to 54 years" | age == "55 to 59 years" | age == "60 to 64 years" | # 50-64 -->
<!--       age == "65 years and over" -->
<!--   ) %>%  -->
<!--   mutate( -->
<!--     age =  -->
<!--       str_replace(age, " to ", "-"),  -->
<!--     age =  -->
<!--       str_remove_all(age, "[a-z]"),  -->
<!--     age = -->
<!--       str_trim(age), -->
<!--     age =  -->
<!--       ifelse( -->
<!--         age == 65,  -->
<!--         "65+", -->
<!--         age -->
<!--       ) -->
<!--   ) %>%  -->
<!--   arrange(age) %>%  -->
<!--   select( -->
<!--     age, year, sex, population_size -->
<!--   ) -->
<!-- ``` -->



<!-- ```{r} -->
<!-- national_population_data <-  -->
<!--   national_population_data %>%  -->
<!--   mutate( -->
<!--     population_size = as.numeric(population_size), -->
<!--     age_group =  -->
<!--       case_when( -->
<!--         (age == "18-24" |  -->
<!--            age == "25-29") ~ "18-29", -->
<!--         (age == "30-34" |  -->
<!--            age == "35-39" |  -->
<!--            age == "40-44" |  -->
<!--            age == "45-49") ~ "30-49", -->
<!--         (age == "50-54" | age == "55-59" | age == "60-64") ~ "50-64", -->
<!--         T ~ age -->
<!--       ) -->
<!--   ) %>%  -->
<!--   group_by(year, sex, age_group) %>%  -->
<!--   summarise( -->
<!--     total_population =  -->
<!--       sum(population_size)  -->
<!--   ) %>%  -->
<!--   ungroup() %>%  -->
<!--   arrange(age_group, year) %>%  -->
<!--   select( -->
<!--     age_group, year, sex, total_population -->
<!--   ) -->
<!-- ``` -->

<!-- ## Population Table -->

<!-- ```{r} -->
<!-- head(national_population_data) -->
<!-- ``` -->


<!-- ## Joining data for visualization -->

<!-- Since the cdc weekly vaccination data does not have a variable for gender, I'll simplify my census data and join them by age_group and year -->

<!-- ```{r} -->
<!-- census_data <-  -->
<!-- national_population_data %>%  -->
<!--   filter(sex == "Both") %>%  -->
<!--   mutate( -->
<!--     age_group = as.factor(age_group), -->
<!--     year = as.numeric(year), -->
<!--     sex = as.factor(sex) -->
<!--   )  -->

<!-- cdc_data <-  -->
<!-- weekly_cumulative_vaccines_administered_data %>%  -->
<!--   mutate( -->
<!--     week_date =  -->
<!--       ymd_hms(Week_ID), -->
<!--     year =  -->
<!--       year(week_date) -->
<!--   ) %>%  -->
<!--   rename(age_group = Age_Group) -->

<!-- vaccination_rate_data <-  -->
<!--   cdc_data %>%  -->
<!--   inner_join( -->
<!--     census_data, -->
<!--     by = 'age_group', suffix = c("_cdc", "_census"),  -->
<!--     relationship = "many-to-many" -->
<!--   ) %>%  -->
<!--   filter(year_cdc == year_census) %>%  -->
<!--   select(-year_census) %>%  -->
<!--   rename( -->
<!--     year = year_cdc -->
<!--   ) %>%  -->
<!--   mutate( -->
<!--     vaccination_rate =  -->
<!--       Doses / total_population * 100, -->
<!--     cumulative_vaccination_rate =  -->
<!--       Cumulative_Doses / total_population * 100 -->
<!--   ) %>%  -->
<!--   filter( -->
<!--     Setting == "Combined" -->
<!--   ) -->
<!-- ``` -->








## Task 2

2.  Use the real data to generate the plot you created in 6.
    How does the real data change the appearance/message of the plot?
    Does anything get easier or more difficult?

## Line Plot 1.1

```{r}
vaccination_rate_data %>% 
  filter(year == "2024", sex == "Both") %>% 
  ggplot(data = ., aes(x = MMWR_Week, y = vaccination_rate,
                       color = age_group, group = age_group)) +
  geom_line(linewidth = 1.2) +
  # geom_point(size = 2.5) +
  # scale_color_manual(values = age_colors) +
  scale_x_continuous(breaks = 1:52) +
  labs(title = "Line Graph - Vaccination Rates Over Time",
       subtitle = "Year = 2024 ",
       tag = "Figure 1.",
       x = "Week",
       y = "Vaccination Rate (%)",
       color = "Age Group")
```

```{r}
vaccination_rate_data %>% 
  filter(`COVID-19_Season` == "2023-2024", sex == "Both") %>% 
  ggplot(data = ., aes(x = MMWR_Week_Order, y = vaccination_rate, 
                       color = age_group, group = age_group)) +
  geom_line(linewidth = 1.2) +
  # geom_point(size = 2.5) +
  # scale_color_manual(values = age_colors) +
  scale_x_continuous(breaks = 1:50) +
  labs(title = "Line Graph - Weekly Vaccination Rates Over Time",
       subtitle = "2023-2024 COVID-19 Season",
       tag = "Figure 2.",
       x = "MMWR Week Order",
       y = "Weekly Vaccination Rate (%)",
       color = "Age Group")
```

Figure 3 is my favorite so I am going to focus on it.


## Task 3

3.  What annotations would you want to add to your chart?
    You may be able to find relevant information about e.g. approval dates of vaccines at [immunize.org's Vaccine Timeline](https://www.immunize.org/vaccines/vaccine-timeline/).
    Add at least one annotation to your chart, but balance utility with clutter.
    
I'd like to find information that may explain the two peaks in Figure 3. They both seem to happen around September. Now, one may assume this could be just because of school beginning, but this data deals with adults, and more importantly the peaks are for people over 65+!

From my findings, the information that seems to be the cause of the spikes in the weekly vaccine rate *in 2023*, is not in the range of the data collected :(.
    
-   CDC recommends everyone 6 months and older get an updated COVID-19 vaccine. Updated COVID-19 vaccines from Pfizer-BioNTech and Moderna will be available later this week. September 12, 2023

-   FDA approves and authorizes emergency use of updated mRNA vaccines (Moderna, Pfizer) for 2023-24. The updated mRNA vaccines are each approved for individuals 12 years of age and older and are authorized under emergency use for individuals 6 months through 11 years of age. Bivalent Moderna and Pfizer-BioNTech COVID-19 vaccines are no longer authorized for use in the United States. September 11, 2023

For 2024 however, we have the following info and dates: 

-   ACIP recommends use of the 2024-25 COVID-19 vaccines for persons six months and older. September 10, 2024

-   FDA approved and granted emergency use authorization (EUA) for updated mRNA COVID-19 vaccines (2024-2025 formula) manufactured by Moderna and Pfizer. August 22, 2024

This could be useful, but in 2024, it looks like things starting to pick up very early August.

### Annotation Adding

```{r}
important_dates <-
  data.frame(
    date = 
      c(
        'September 11, 2023',
        # 'September 12, 2023', for a less cluttered graph 
        # I'll only include one date for each year
        
        # 'September 10, 2024',
        'August 22, 2024'
      ),
    label = 
      c(
        "CDC: Everyone get updated COVID-19 vaccine*",
        # 'FDA approves and authorizes emergency use of updated mRNA vaccines (Moderna, Pfizer) for 2023-24. Older vaccinesare no longer authorized for use in the US.',
        # 'ACIP recommends use of the 2024-25 COVID-19 vaccines for persons six months and older.',
        'FDA: Granted EUA on new COVID-19 vaccine**'
      )
  ) ; important_dates$date <- mdy(important_dates$date)
```


```{r}
vaccination_rate_data %>% 
  filter(sex == "Both") %>% 
  ggplot(
    data = ., 
    aes(x = as.Date(Week_ID), 
        y = vaccination_rate
        )
    ) +
  geom_line(aes(color = age_group, group = age_group), linewidth = 1.2) +
  
  
  geom_vline(
    data = important_dates, 
    aes(xintercept = date), 
    linetype = "dashed",
    color = "black",
    linewidth = 0.8,
    alpha = 0.7
  ) +
  geom_text(
    data = important_dates,
    aes(x = date,
        y = 0,
        label = label),
    angle = 90,
    vjust = -1,
    hjust = -0.2,
    color = "black",
    size = 2.4
  ) +
  # scale_color_manual(values = age_colors) +
  scale_x_date(
    date_breaks = "2 months",
    date_labels = "%Y-%m-%d"  ) + 
  labs(title = "Weekly COVID-19 Vaccination Rates From 2023/09/16 - 2024/12/28",
       # subtitle = "with annotatd",
       tag = "Figure 3.",
       x = "Date",
       y = "Weekly Vaccination Rate (%)",
       color = "Age Group",
       caption = "*CDC recommends everyone 6 months and older get an updated COVID-19 vaccine, 2023/09/11.\n **FDA approved and granted emergency use authorization (EUA) for updated mRNA COVID-19 vaccines, 2024/08/22."
       ) + 
  theme(
    axis.text.x = element_text(angle = 20, hjust = 1),
    plot.caption = element_text(hjust = 0, size = 7)
  )

```


## Task 4

4.  How would you modify this chart if your goal was to compare vaccination rates for each age group in 2023 and 2024?
    Explain your answer, highlighting how your modifications would reduce the cognitive load of making the comparison of interest.
    
First off, I'd need the CDC data for all of 2023. 

I would go about this in two ways:
  
-   Make two charts for each age group
-   Make one chart for each year

## Task 5

5.  How would you use your statistical training to test and visually highlight any statistically significant differences?
    Explain.
    You do not have to actually implement any statistical testing to answer this question.
    
Take the average vaccination rate for each age group and find the difference of means for each pair.
